<script type="text/javascript">

import java.applet.Applet;
import java.awt.Color;
import java.awt.Font;
import java.awt.FontMetrics;
import java.awt.Graphics;
import java.awt.geom.Rectangle2D;
import java.util.Calendar;

class texte {
    int x, y;        // Position du texte.
    String texte;    // Le texte à afficher.
    Color couleur;    // La couleur du texte à afficher.
    
    // Constructeur de la class Texte.
    texte(int valX, int valY, String leTexte, Color coul) {
        x = valX;
        y = valY;
        texte = leTexte;
        couleur = coul;
    }
    // Méthode permettant l'affichage du texte.
    void afficher(Graphics g) {
        g.setColor(couleur);
        g.drawString(texte, x, y);
    }
}

public class horlogeAnal extends Applet implements Runnable {
    volatile Thread timer;           // Processus léger actif
    Font f;                          // Fonte du texte
    Color texteColor;                 // Couleur du texte
    Color fondColor;                // Couleur du fond de l'applet.
    texte laDate;                    // Récupération des données pour afficher la date et l'heure actuelle.
    String txtDate;
    texte lHeure;
    String txtHeure;
    int format;
    final static long tempo = 500;                // Temporisation. 1000 = 1s
    
    int pos_x, pos_y;                // Position du texte à afficher.
    
    int hh, mm, ss;                    // Récupération des heures, minutes et secondes.
    int jourSemaine, jourMois, mois, annee;
    
    public static Color lesCouleur[] = {Color.BLACK,
                                        Color.BLUE,
                                        Color.CYAN,
                                        Color.DARK_GRAY,
                                        Color.GRAY,
                                        Color.LIGHT_GRAY,
                                        Color.GREEN,
                                        Color.MAGENTA,
                                        Color.ORANGE,
                                        Color.PINK,
                                        Color.RED,
                                        Color.WHITE,
                                        Color.YELLOW};
    
    public Color choixCouleur(int laCouleur) {
        return lesCouleur[laCouleur];
    }
    
    public void init() {        
        try {            
            f = new Font("Dialog", Font.PLAIN, 15);

            // Récupération de l'entier en base 16 
            // représentant la couleur du texte.
            int colorT = Integer.parseInt(getParameter("textcolor"));
            //texteColor = new Color(colorT);
            
            // Récupération de l'entier en base 16 
            // représentant la couleur du fond.
            int colorF = Integer.parseInt(getParameter("fondcolor"));
            //fondColor = new Color(colorF);
            
            // Récupération de la formulation.
            format = Integer.parseInt(getParameter("format"));
            
            texteColor = choixCouleur(colorT);
               fondColor = choixCouleur(colorF);    
            
               setBackground(fondColor);
            
          } catch (Exception e) {
              texteColor = Color.black;     // Texte noir par défaut 
            fondColor = Color.white;     // Fond blanc par défaut.
            setBackground(fondColor);
            format = 4;
          }
    }
    
    public void paint(Graphics g) {        
        g.setFont(f);
        Rectangle2D rect2d;
        Calendar now = Calendar.getInstance();
        int hh = now.get(Calendar.HOUR_OF_DAY);            // On récupère l'heure.
        int mm = now.get(Calendar.MINUTE);                // On récupère les minutes.
        String min = "";
        int ss = now.get(Calendar.SECOND);                // On récupère les secondes.
        String sec = "";
        int mois = now.get(Calendar.MONTH) + 1;            // On récupère le mois.
        int jour= now.get(Calendar.DAY_OF_MONTH);        // On récupère le jour du mois.
        int annee = now.get(Calendar.YEAR);                // On récupère l'année.
        int nomJour = now.get(Calendar.DAY_OF_WEEK);    // On récupère le jour de la semaine.
        String jourSemaine = "";            
        // Traitement de l'information pour récupérer le nom du jour.
        // Dimanche = 1, Lundi = 2, ..., Samedi = 7.
           switch(nomJour) {
               case 1:
                   jourSemaine = "Dimanche";
                   break;               
               case 2:
                   jourSemaine = "Lundi";
                   break;               
               case 3:
                   jourSemaine = "Mardi";
                   break;               
               case 4:
                   jourSemaine = "Mercredi";
                   break;               
               case 5:
                   jourSemaine = "Jeudi";
                   break;               
               case 6:
                   jourSemaine = "Vendredi";
                   break;               
               case 7:
                   jourSemaine = "Samedi";
                   break;
           }
           
           FontMetrics fm=getFontMetrics(getFont());
           
           txtHeure = "";
           txtDate = "";
           
           if(ss < 10)
               sec = "0" + ss;
           else
               sec = ss + "";
           
           if(mm < 10)
               min = "0" + mm;
           else
               min = mm + "";
           
        switch(format) {
           case 0:    // Affiche du format hh:mm.
               txtHeure = hh + ":" + min;
               pos_x = (getSize().width - fm.stringWidth(txtHeure)) / 2;
               pos_y = (getSize().height + fm.getHeight()) / 2 ;
               lHeure = new texte(pos_x, pos_y, txtHeure, texteColor);
               rect2d = fm.getStringBounds(txtHeure, g);
               lHeure.afficher(g);
               break;
           case 1:    // Affichage du format Il est hh:mm:ss.
               txtHeure = "Il est " + hh + ":" + min + ":" + sec;
               pos_x = (getSize().width - fm.stringWidth(txtHeure)) / 2;
               pos_y = (getSize().height + fm.getHeight()) / 2 ;
               lHeure = new texte(pos_x, pos_y, txtHeure, texteColor);
               lHeure.afficher(g);
               break;
           case 2:    // Affichage de la date selon le format jour/mois/année.
               txtDate = jour + "/" + mois + "/" + annee;
               pos_x = (getSize().width - fm.stringWidth(txtDate)) / 2;
               pos_y = (getSize().height + fm.getHeight()) / 2 ;
               laDate = new texte(pos_x, pos_y, txtDate, texteColor);
               laDate.afficher(g);
               break;
           case 3: // Affichage de la date selon le format jourSemaine jour/mois/année.
               txtDate = "Nous sommes le " + jourSemaine + jour + "/" + mois + "/" + annee;
               pos_x = (getSize().width - fm.stringWidth(txtDate)) / 2;
               pos_y = (getSize().height + fm.getHeight()) / 2 ;
               laDate = new texte(pos_x, pos_y, txtDate, texteColor);
               laDate.afficher(g);
               break;
           case 4: // Affichage complet de la date et de l'heure.
               txtHeure = "Il est " + hh + ":" + min + ":" + sec;
               pos_x = (getSize().width - fm.stringWidth(txtHeure)) / 2;
               pos_y = ((getSize().height + fm.getHeight()) / 2 ) + fm.getHeight() / 2;
               lHeure = new texte(pos_x, pos_y, txtHeure, texteColor);
               lHeure.afficher(g);
               txtDate = "Nous sommes le " + jourSemaine+ " " + jour + "/" + mois + "/" + annee;
               pos_x = (getSize().width - fm.stringWidth(txtDate)) / 2;
               pos_y = ((getSize().height + fm.getHeight()) / 2) - fm.getHeight() / 2;
               laDate = new texte(pos_x, pos_y, txtDate, texteColor);
               laDate.afficher(g);
               break;
        }
    }
    
    /**
      * Création d'un nouveau processus léger de mise à jour.
      */
    public void start() {
        timer = new Thread(this);
        timer.start();
    }
    
    /**
      * Rafraîchissement de l'heure.
      */
    public void run() {
        try {
            Thread t = Thread.currentThread();
            while (timer == t) { // En cas de start() multiples
                t.sleep(tempo);
              
            // Appel à la méthode paint() sur le bon contexte graphique
            repaint();
            }
        } catch (InterruptedException e) { }
      }
      
      /**
       * Demande l'arrêt du processus léger de mise à jour.
       */
      public void stop() {
          timer.interrupt();
      }
      
      public String getAppletInfo() {
        return new String("Titre: Horloge \n" +
                          "Author: Pascal AKNOUCHE\n" +
                             "Simple horloge textuelle.");
      }
}
</script>
